@startuml TSA_L2

skinparam defaultFontName "Serif"
skinparam shadowing false
skinparam linetype ortho
skinparam dpi 300

skinparam activity {
  BackgroundColor white
  BorderColor black
  FontName "Serif"
  FontSize 14
}
skinparam note {
  BackgroundColor #f8f8f8
  BorderColor gray
  FontName "Serif"
  FontSize 12
  FontStyle italic
}
skinparam arrow {
  Color black
}

start

partition "1. Обробка Часового Простору та Сигналу" {
    :Вхідні дані <math>D_{raw} = \{t, y\}</math>;
    :<b>Рівнодискретність</b>\n<math>y(t_j) = last({ r_id(τ) | t_j ≤ τ < t_j + 1h })</math>;
    :<b>Відновлення неперервності</b>\nМетод: Forward Fill\nГіпотеза: <math>y(t) = y(t-1)</math>\n(за відсутності подій);
    :<b>Перевірка монотонності<\b>\nУмова валідності для кумулятивного <math>y(t)</math>:\n<math>\frac{dy}{dt} \ge 0 \Rightarrow y(t) - y(t-1) \ge -\varepsilon</math>\nЯкщо <math>\Delta y < 0</math> — видалення та інтерполяція;
}

partition "2. Математичне Моделювання (Конкурентні Гіпотези)" {
    fork
        :Гіпотеза H1: Поліноміальна регресія 2-го порядку\nАпроксимація тренду:\n<math>y(t) = at^2 + bt + c</math>\n\nМетод: Найменші квадрати (OLS)\nАналітичний розв'язок;
    fork again
        :Гіпотеза H2: Логістичне зростання\nФізична модель насичення:\n<math>y(t) = \frac{L}{1 + e^{-k(t - t_0)}}</math>\n\n<math>L</math> : ємність системи\n<math>k</math> : швидкість віральності\n<math>t_0</math> : точка перегину;
    
        :Ініціалізація параметрів <math>θ = {L, k, t_0}</math>\nЕвристика: <math>L \approx 1.05 \cdot \max(y)</math>;
    
        repeat
            :Прямий прохід;
            :Обчислення функції втрат\n<math>MSE = \frac{1}{n}\sum (y_i - \hat{y}_i)^2</math>;
            
            :Обчислення градієнтів <math>∇J(θ)</math>\nЛанцюгове правило:\n<math>\frac{\partial J}{\partial \theta}</math>;
            
            :Оптимізація параметрів (Adam)\nАдаптивна оцінка моментів:\nКорекція 1-го (<math>m</math>) та 2-го (<math>v</math>) моментів;
        
        repeat while (epoch < MaxEpochs)
    end fork
}

partition "3. Статистична оцінка та селекція" {
    :Розрахунок метрик якості\n1. Точність: <math>RMSE, MAE, R^22</math>\n2. Інформаційні критерії:\n   <math>AIC = 2k + n\ln(RSS/n)</math>\n   <math>BIC = k\ln(n) + n\ln(RSS/n)</math>;
    if (<math>AIC_{poly}</math> < <math>AIC_{logistic}</math>) then (так)
        :Переможець: Поліноміальна модель;
    else (ні)
        :Переможець: Логістична модель;
    endif
}

:Генерація звітів та візуалізація\n- Екстраполяція (на 50%) <math>t \rightarrow t_{future}</math>\n- Гістограма залишків;

stop

@enduml
