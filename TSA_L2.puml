@startuml TSA_L2

skinparam defaultFontName "Serif"
skinparam shadowing false
skinparam linetype ortho
skinparam dpi 300

skinparam activity {
  BackgroundColor white
  BorderColor black
  FontName "Serif"
  FontSize 14
}
skinparam note {
  BackgroundColor #f8f8f8
  BorderColor gray
  FontName "Serif"
  FontSize 12
  FontStyle italic
}
skinparam arrow {
  Color black
}

start

partition "1. Обробка Часового Простору та Сигналу" {
    :Вхідні дані <math>D_{raw} = \{t, y\}</math>;
    :Дискретизація сигналу (Resampling)\nКрок: <math>\Delta t = 1h</math>\nОператор: last();
    :Відновлення неперервності (Imputation)\nМетод: Forward Fill\nГіпотеза: <math>y(t) = y(t-1)</math>\n(за відсутності подій);
    :Перевірка монотонності (Anomaly Detection)\nУмова валідності для кумулятивного <math>y(t)</math>:\n<math>\frac{dy}{dt} \ge 0 \Rightarrow y(t) - y(t-1) \ge -\varepsilon</math>\nЯкщо <math>\Delta y < 0</math> — видалення та інтерполяція;
}

partition "2. Математичне Моделювання (Конкурентні Гіпотези)" {
    fork
        :Гіпотеза H1: Поліноміальна регресія\nАпроксимація тренду:\n<math>y(t) = at^2 + bt + c</math>\n\nМетод: Найменші квадрати (OLS)\nАналітичний розв'язок;
    
    fork again
        :Гіпотеза H2: Логістичне зростання (S-Curve)\nФізична модель насичення:\n<math>y(t) = \frac{L}{1 + e^{-k(t - t_0)}}</math>\n\nL : ємність системи\nk : швидкість віральності\nt0 : точка перегину;
    
        :Ініціалізація параметрів θ = {L, k, t0}\nЕвристика: <math>L \approx 1.05 \cdot \max(y)</math>;
    
        repeat
            :Прямий прохід (Forward Pass);
            :Обчислення Функції Втрат (Loss)\n<math>MSE = \frac{1}{n}\sum (y_i - \hat{y}_i)^2</math>;
            
            :Обчислення градієнтів ∇J(θ)\nЛанцюгове правило (Chain Rule):\n<math>\frac{\partial J}{\partial \theta}</math>;
            
            :Оптимізація параметрів (Adam)\nАдаптивна оцінка моментів:\nКорекція 1-го (m) та 2-го (v) моментів;
        
        repeat while (epoch < MaxEpochs)
    end fork
}

partition "3. Статистична Оцінка та Селекція" {
    :Розрахунок метрик якості\n1. Точність: RMSE, MAE, R²\n2. Інформаційні критерії:\n   <math>AIC = 2k + n\ln(RSS/n)</math>\n   <math>BIC = k\ln(n) + n\ln(RSS/n)</math>;
    if (AIC_poly < AIC_logistic ?) then (так)
        :Переможець: Поліноміальна модель;
    else (ні)
        :Переможець: Логістична модель;
    endif
}

:Генерація звітів та візуалізація\n- Екстраполяція <math>t \rightarrow t_{future}</math>\n- Гістограма залишків (Residuals);

stop

@enduml
